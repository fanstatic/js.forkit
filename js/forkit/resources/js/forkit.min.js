/*!
 * forkit.js 0.2
 * http://lab.hakim.se/forkit-js
 * MIT licensed
 *
 * Created by Hakim El Hattab, http://hakim.se
 */
(function(){var d=0,x=1,z=2,b=30,c=200,w=40,h=0.36;VENDORS=["Webkit","Moz","O","ms"];var v={ribbon:null,ribbonString:null,ribbonTag:null,curtain:null,closeButton:null},f=d,u="",k="",j=1.04;gravity=1.5,closedX=c*0.4,closedY=-b*0.5,openedX=c*0.4,openedY=b,velocity=0,rotation=45,curtainTargetY=0,curtainCurrentY=0,dragging=false,dragTime=0,dragY=0,anchorA=new A(closedX,closedY),anchorB=new A(closedX,closedY),mouse=new A();function a(){v.ribbon=document.querySelector(".forkit");v.curtain=document.querySelector(".forkit-curtain");v.closeButton=document.querySelector(".forkit-curtain .close-button");if(v.ribbon){u=v.ribbon.getAttribute("data-text")||"";k=v.ribbon.getAttribute("data-text-detached")||u;v.ribbon.innerHTML='<span class="string"></span><span class="tag">'+u+"</span>";v.ribbonString=v.ribbon.querySelector(".string");v.ribbonTag=v.ribbon.querySelector(".tag");v.ribbon.addEventListener("click",m,false);document.addEventListener("mousemove",r,false);document.addEventListener("mousedown",l,false);document.addEventListener("mouseup",e,false);window.addEventListener("resize",y,false);if(v.closeButton){v.closeButton.addEventListener("click",i,false)}g()}}function l(D){if(v.curtain&&f===x){D.preventDefault();dragY=D.clientY;dragTime=Date.now();dragging=true}}function r(D){mouse.x=D.clientX;mouse.y=D.clientY}function e(D){if(f!==z){f=d;dragging=false}}function m(D){if(v.curtain){D.preventDefault();if(f===z){s()}else{if(Date.now()-dragTime<300){q()}}}}function i(D){D.preventDefault();s()}function y(){if(f===z){curtainTargetY=window.innerHeight;curtainCurrentY=curtainTargetY}}function q(){dragging=false;f=z}function s(){dragging=false;f=d;v.ribbonTag.innerHTML=u}function B(){f=x;v.ribbonTag.innerHTML=k}function g(){n();C();requestAnimFrame(g)}function n(){var J=o(mouse.x,mouse.y,window.innerWidth,0);if(f===z){curtainTargetY=Math.min(curtainTargetY+(window.innerHeight-curtainTargetY)*0.2,window.innerHeight)}else{if(J<c*1.5){B()}else{if(!dragging&&f===x&&J>c*2){s()}}if(dragging){curtainTargetY=Math.max(mouse.y-dragY,0);if(curtainTargetY>window.innerHeight*h){q()}}else{curtainTargetY*=0.8}}curtainCurrentY+=(curtainTargetY-curtainCurrentY)*0.3;if(dragging||f===x){velocity/=j;velocity+=gravity;var G=v.ribbon.offsetLeft;var D=Math.max(((mouse.x-G)-closedX)*0.2,-w);anchorB.x+=((closedX+D)-anchorB.x)*0.1;anchorB.y+=velocity;var H=o(anchorA.x,anchorA.y,anchorB.x,anchorB.y);if(H>w){velocity-=Math.abs(H)/(w*1.25)}var E=Math.max(mouse.y-anchorB.y,0),F=mouse.x-(G+anchorB.x);var I=Math.min(130,Math.max(50,Math.atan2(E,F)*180/Math.PI));rotation+=(I-rotation)*0.1}else{if(f===z){anchorB.x+=(openedX-anchorB.x)*0.2;anchorB.y+=(openedY-anchorB.y)*0.2;rotation+=(90-rotation)*0.02}else{anchorB.x+=(anchorA.x-anchorB.x)*0.2;anchorB.y+=(anchorA.y-anchorB.y)*0.2;rotation+=(45-rotation)*0.2}}}function C(){if(v.curtain){v.curtain.style.top=-100+Math.min((curtainCurrentY/window.innerHeight)*100,100)+"%"}v.ribbon.style[t("transform")]=p(0,curtainCurrentY,0);v.ribbonTag.style[t("transform")]=p(anchorB.x,anchorB.y,rotation);var D=anchorB.y-anchorA.y,E=anchorB.x-anchorA.x;var F=Math.atan2(D,E)*180/Math.PI;v.ribbonString.style.width=anchorB.y+"px";v.ribbonString.style[t("transform")]=p(anchorA.x,0,F)}function t(H,G){var E=H.slice(0,1).toUpperCase()+H.slice(1);for(var F=0,D=VENDORS.length;F<D;F++){var I=VENDORS[F];if(typeof(G||document.body).style[I+E]!=="undefined"){return I+E}}return H}function p(D,F,E){return"translate("+D+"px,"+F+"px) rotate("+E+"deg)"}function o(G,I,F,H){var E=G-F;var D=I-H;return Math.sqrt(E*E+D*D)}function A(D,E){this.x=D||0;this.y=E||0}A.prototype.distanceTo=function(D,G){var F=D-this.x;var E=G-this.y;return Math.sqrt(F*F+E*E)};A.prototype.clone=function(){return new A(this.x,this.y)};A.prototype.interpolate=function(D,F,E){this.x+=(D-this.x)*E;this.y+=(F-this.y)*E};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(D){window.setTimeout(D,1000/60)}})();a()})();
